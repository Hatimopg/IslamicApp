name: Flutter APK â†’ Hostinger

# ğŸ” DÃ©clenchement automatique
# La pipeline se lance Ã  CHAQUE push sur la branche main
on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    # ğŸ–¥ï¸ Machine virtuelle Linux fournie par GitHub
    runs-on: ubuntu-latest

    steps:
      # ğŸ“¥ RÃ©cupÃ¨re le code depuis le repo GitHub
      - name: Checkout code
        uses: actions/checkout@v4

      # ğŸ§° Installe Flutter sur la machine
      - name: Install Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.19.0"

      # ğŸ“¦ TÃ©lÃ©charge les dÃ©pendances Flutter
      - name: Install dependencies
        run: flutter pub get

      # ğŸ§ª Lance les tests
      # âŒ Si un test Ã©choue â†’ la pipeline Sâ€™ARRÃŠTE ici
      - name: Run tests
        run: flutter test

      # ğŸ—ï¸ Build lâ€™APK en mode release
      # âŒ Si le build Ã©choue â†’ la pipeline Sâ€™ARRÃŠTE ici
      - name: Build release APK
        run: flutter build apk --release

      # âœï¸ Renomme lâ€™APK pour quâ€™il corresponde
      # exactement au lien utilisÃ© dans ton HTML
      - name: Rename APK for website
        run: |
          mv build/app/outputs/flutter-apk/app-release.apk \
             build/app/outputs/flutter-apk/LCI-Ronse-beta.apk

      # ğŸš€ Upload automatique sur Hostinger via FTP
      # âŒ Si FTP KO â†’ pipeline FAIL
      - name: Upload APK to Hostinger via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASS }}
          local-dir: build/app/outputs/flutter-apk/
          server-dir: /public_html/
